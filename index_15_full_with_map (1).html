<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>StudyGO タイプ診断（15問+画像+マップ）</title>
  <style>
    body {
      font-family: 'Segoe UI', 'メイリオ', sans-serif;
      background: linear-gradient(to bottom, #f9f9ff, #eef3ff);
      padding: 30px;
      color: #333;
    }
    h1 {
      color: #2a4d9b;
      text-align: center;
    }
    .question {
      margin-bottom: 30px;
      padding: 15px;
      background: #ffffff;
      border-radius: 10px;
      box-shadow: 0 0 8px rgba(0,0,0,0.05);
    }
    button {
      display: block;
      background-color: #f4f4f4;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 10px 16px;
      margin: 8px 0;
      cursor: pointer;
      font-size: 15px;
    }
    button:hover {
      background-color: #dde8ff;
      border-color: #6698ff;
    }
    #result {
      margin-top: 30px;
      font-weight: bold;
      font-size: 20px;
      text-align: center;
    }
    #result img {
      width: 80%;
      max-width: 400px;
      border-radius: 12px;
      margin-top: 20px;
    }
    .note {
      font-size: 13px;
      color: #666;
      margin-top: 10px;
    }
  </style>
</head>
<body>

<h1>🎓 あなたに最適な勉強場所タイプ診断（15問）</h1>
<div id="quiz"></div>
<div id="result"></div>

<script>
const questions = Array.from({ length: 15 }, (_, i) => ({
  text: `質問 ${i + 1}：この設問はカスタマイズ可能です`,
  answers: [
    { text: "選択肢 A", score: { jishushitsu: 1 } },
    { text: "選択肢 B", score: { toshokan: 1 } },
    { text: "選択肢 C", score: { coworking: 1, cafe: 1, family: 1 } }
  ]
}));

let current = 0;
let score = { jishushitsu: 0, toshokan: 0, coworking: 0, cafe: 0, family: 0 };

const quiz = document.getElementById("quiz");
const result = document.getElementById("result");

function showQuestion() {
  const q = questions[current];
  quiz.innerHTML = `<div class="question"><p><strong>Q${current + 1}.</strong> ${q.text}</p></div>`;
  q.answers.forEach((a) => {
    const btn = document.createElement("button");
    btn.textContent = a.text;
    btn.onclick = () => {
      Object.keys(a.score).forEach(type => {
        score[type] += a.score[type];
      });
      current++;
      if (current < questions.length) {
        showQuestion();
      } else {
        showResult();
      }
    };
    quiz.appendChild(btn);
  });
}

function showResult() {
  const max = Math.max(...Object.values(score));
  const type = Object.keys(score).find(k => score[k] === max);
  const names = {
    jishushitsu: "有料自習室",
    toshokan: "図書館",
    coworking: "コワーキングスペース",
    cafe: "カフェ",
    family: "ファミリーレストラン"
  };
  const images = {
    jishushitsu: "https://source.unsplash.com/featured/?study,desk",
    toshokan: "https://source.unsplash.com/featured/?library,study",
    coworking: "https://source.unsplash.com/featured/?coworking,office",
    cafe: "https://source.unsplash.com/featured/?cafe,coffee",
    family: "https://source.unsplash.com/featured/?diner,restaurant"
  };

  let resultHTML = `
    <p>あなたに最適なのは…</p>
    <h2>🎯【${names[type]}】タイプ！</h2>
    <img src="${images[type]}" alt="${names[type]}のイメージ画像">
    <div><a href="https://studygo.jp" target="_blank">▶ 掲載店舗を見る</a></div>
  `;

  if (["cafe", "family", "toshokan"].includes(type)) {
    navigator.geolocation.getCurrentPosition(function(pos) {
      const lat = pos.coords.latitude;
      const lng = pos.coords.longitude;
      const query = encodeURIComponent(names[type]);
      const mapURL = `https://www.google.com/maps/search/${query}/@${lat},${lng},15z`;
      result.innerHTML = resultHTML + 
        `<p><a href="${mapURL}" target="_blank">📍 周辺の${names[type]}をGoogleマップで探す</a></p>
         <p class="note">※ 現在、StudyGOでは図書館・カフェ・ファミレスの掲載はありません。順次拡大中です。</p>`;
    }, function() {
      result.innerHTML = resultHTML + 
        `<p>※ 位置情報の取得に失敗しました。</p>
         <p class="note">※ 現在、StudyGOでは図書館・カフェ・ファミレスの掲載はありません。順次拡大中です。</p>`;
    });
  } else {
    result.innerHTML = resultHTML;
  }

  quiz.innerHTML = "";
}

showQuestion();
</script>

</body>
</html>
